!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t("undefined"!=typeof exports?require("jquery"):jQuery)}(function(t){"use strict";function e(e,i){this.$booking=t(e),this.options=t.extend({},a,i),this._defaults=a,this._name=n,this.init()}var n="copaBooking",a={lang:"es",origin:"all",destination:"all",templatePath:"bower_components/copaair-widgets/templates/booking.hbs",languagePath:"bower_components/copaair-widgets/language/",formUrl:"https://bookings.copaair.com/CMGS/AirLowFareSearchExternal.do?"},i={allDestinations:"https://copaapi.nbxapps.com/destinations/",countryDestinations:"https://copaapi.nbxapps.com/destinations/?country="};e.prototype.init=function(){var e=this;return t.getJSON(e.options.languagePath+e.options.lang+".json",function(t){e.languageStrings=t,e.compileTemplate(function(){e.setupSelectMenus(),e.setupAutocomplete(),e.setupDatePickers()})}),this},e.prototype.compileTemplate=function(e){var n=this;return"undefined"!=typeof Handlebars&&null!==Handlebars?t.ajax({url:n.options.templatePath,success:function(t){var e=Handlebars.compile(t),a=e(n.languageStrings);n.$booking.html(a)},complete:function(){"function"==typeof e&&e()}}):console.error("This plugin requires Handlebars.js"),this},e.prototype.setupSelectMenus=function(){return t(".js-selectmenu").selectmenu(),this},e.prototype.setupAutocomplete=function(){var t=this;return this.fetchDestinations(function(){t.buildAutocomplete(function(){console.log("boomshakalaka")})}),this},e.prototype.fetchDestinations=function(e){var n=this,a=i.allDestinations,o=n.options.lang;return n.destinations=[],t.getJSON(a,function(a){a.sort(function(t,e){return t.name[o]>e.name[o]?1:t.name[o]<e.name[o]?-1:0});var i=[];t.each(a,function(t,e){var n="<b>"+e.name[o]+", "+e.country+'</b><span class="code"> | '+e.id+"</span>",a=e.id,r=e.name[o]+", "+e.id;i.push({label:n,value:a,display:r})}),n.destinations=i,"function"==typeof e&&e()}),this},e.prototype.buildAutocomplete=function(e){var n=this;return this.$booking.find(".js-booking-autocomplete").each(function(){var e=t(this).hide(),a=e.val(),i=e.attr("placeholder"),o=e.data("input-field"),r=t("<input />").val(a).attr("type","text").attr("placeholder",i);r.autocomplete({delay:0,minLength:0,appendTo:n.$booking,source:n.destinations,select:function(e,n){return r.val(n.item.display),"origin"===o||"destination"===o?(t(".js-"+o+"-input-outbound").val(n.item.value),t(".js-"+o+"-input-inbound").val(n.item.value)):console.log("The form needs two trip type inputs: origin and destination"),!1}}),r.addClass("copaair-booking-control  copaair-booking-combobox-input").addClass("ui-widget  ui-widget-content  ui-state-default"),r.insertAfter(e),r.autocomplete("instance")._renderItem=function(e,n){return t("<li>").append(n.label).appendTo(e)},t.ui.autocomplete.filter=function(e,n){var a=new RegExp("\\b"+t.ui.autocomplete.escapeRegex(n),"i");return t.grep(e,function(t){return a.test(t.label||t.value||t)})}}),"function"==typeof e&&e(),this},e.prototype.setupDatePickers=function(){t(".copaair-booking-datepicker-departure").datepicker({minDate:new Date}),t(".copaair-booking-datepicker-return").datepicker({minDate:new Date});var e=new Date,n=new Date(e.getTime()+6048e5);return t(".copaair-booking-datepicker-departure").datepicker("setDate",e),t(".copaair-booking-datepicker-return").datepicker("setDate",n),this.defaultDates(),this},e.prototype.defaultDates=function(){var e=this.$booking,n=t(".copaair-booking-datepicker-departure").datepicker("getDate"),a=t(".copaair-booking-datepicker-return").datepicker("getDate");return e.find('input[name="inboundOption.departureDay"]').attr("value",a.getUTCDate()),e.find('input[name="inboundOption.departureMonth"]').attr("value",a.getMonth()+1),e.find('input[name="inboundOption.departureYear"]').attr("value",a.getFullYear()),e.find('input[name="outboundOption.departureDay"]').attr("value",n.getUTCDate()),e.find('input[name="outboundOption.departureMonth"]').attr("value",n.getMonth()+1),e.find('input[name="outboundOption.departureYear"]').attr("value",n.getFullYear()),this},e.prototype.bookingEvents=function(){var e=t(".copaair-booking"),n=t(".copaair-booking-datepicker-departure"),a=t(".copaair-booking-datepicker-return"),i=(t(".copaair-booking-origin"),t(".copaair-booking-destination"),function(t,n){var i=new Date(n.selectedYear,n.selectedMonth,n.selectedDay),o=new Date(i.getTime()+6048e5);a.datepicker("setDate",o),e.find('input[name="inboundOption.departureDay"]').attr("value",o.getUTCDate()),e.find('input[name="inboundOption.departureMonth"]').attr("value",o.getMonth()+1),e.find('input[name="inboundOption.departureYear"]').attr("value",o.getFullYear()),a.datepicker("option","minDate",i),e.find('input[name="outboundOption.departureDay"]').attr("value",n.selectedDay),e.find('input[name="outboundOption.departureMonth"]').attr("value",n.selectedMonth+1),e.find('input[name="outboundOption.departureYear"]').attr("value",n.selectedYear)}),o=function(t,n){e.find('input[name="inboundOption.departureDay"]').attr("value",n.selectedDay),e.find('input[name="inboundOption.departureMonth"]').attr("value",n.selectedMonth+1),e.find('input[name="inboundOption.departureYear"]').attr("value",n.selectedYear)};n.datepicker("option","onSelect",i),a.datepicker("option","onSelect",o),this.submitForm(e)},e.prototype.submitForm=function(e){var n=this;e.on("submit",function(a){a.preventDefault();var i=t(this).serialize(),o=n.options.formUrl;if(n.validationError(e))console.log("error in the form");else{var r=window.open(o+i,"_blank");r.focus()}})},t.fn[n]=function(a){return this.each(function(){t.data(this,"plugin_"+n)||t.data(this,"plugin_"+n,new e(this,a))})}});
//# sourceMappingURL=maps/booking.min.js.map